{"version":3,"file":"ProjectInfoManager.js","sourceRoot":"","sources":["../../src/remoteBuilder/ProjectInfoManager.ts"],"names":[],"mappings":";;;;;;;;;;;;;;;AAAA,AAAO,AAAE,AAAU,AAAE,AAAM,AAAY;;;;;;AACvC,AAAO,AAAE,AAAI,AAAE,AAAM,AAAU;;;;AAC/B,AAAO,AAAK,AAAI,AAAM,AAAM,AAG5B,AAAM;;;;;AAGJ,gBAAqB,AAAkB;AAAlB,aAAQ,WAAR,AAAQ,AAAU;AAF9B,aAAQ,WAAG,AAAI,AAAI,uCAAC,AAAG,AAAE,MAAC,AAAI,KAAC,AAA4B,AAAE,AAAC,AAGvE;AAAC;AAEa,AAA4B,gCAAlC,AAAK;;;;AACX,kBAAM,AAAQ,WAAG,AAAI,MAAC,AAAQ;AAC9B,kBAAM,AAAO,UAAG,MAAM,AAAQ,SAAC,AAAc,eAAC,AAAa,cAAC,EAAC,AAAM,QAAE,AAAuB,AAAC,AAAC;AAC9F,AAA+D;AAC/D,kBAAM,AAAI;AACR,AAAQ,0BAAE,AAAQ,SAAC,AAAQ;AAC3B,AAAa,+BAAE,AAAQ,SAAC,AAAM;AAC9B,AAAc,gCAAE,MAAM,AAAQ,SAAC,AAAc;AAC7C,AAAoB,sCAAE,AAAI,MAAC,AAAQ,SAAC,AAAQ,SAAC,AAAiB,AAAC,AAChE;AALiB;AAMlB,AAAE,AAAC,gBAAC,AAAQ,SAAC,AAAQ,aAAK,AAAQ,SAAC,AAAW,eAAI,AAAQ,SAAC,AAAW,eAAI,AAAI,AAAC,MAAC,AAAC;AAC/E,AAAI,qBAAC,AAAW,cAAG,AAAQ,SAAC,AAAW,AACzC;AAAC;AACD,kBAAM,AAAI,OAAG,AAAI,MAAC,AAAI,KAAC,AAAO,SAAE,AAAW,AAAC;AAC5C,kBAAM,AAAU,gDAAC,AAAI,MAAE,AAAI,AAAC;AAC5B,AAAM,mBAAC,AAAI,AACb;;AAAC,AACF","sourcesContent":["import { outputJson } from \"fs-extra-p\"\nimport { Lazy } from \"lazy-val\"\nimport * as path from \"path\"\nimport { Packager } from \"../packager\"\n\nexport class ProjectInfoManager {\n  readonly infoFile = new Lazy(() => this.saveConfigurationAndMetadata())\n\n  constructor(readonly packager: Packager) {\n  }\n\n  private async saveConfigurationAndMetadata() {\n    const packager = this.packager\n    const tempDir = await packager.tempDirManager.createTempDir({prefix: \"remote-build-metadata\"})\n    // we cannot use getTempFile because file name must be constant\n    const info: any = {\n      metadata: packager.metadata,\n      configuration: packager.config,\n      repositoryInfo: await packager.repositoryInfo,\n      buildResourceDirName: path.basename(packager.buildResourcesDir)\n    }\n    if (packager.metadata !== packager.devMetadata && packager.devMetadata != null) {\n      info.devMetadata = packager.devMetadata\n    }\n    const file = path.join(tempDir, \"info.json\")\n    await outputJson(file, info)\n    return file\n  }\n}"]}
