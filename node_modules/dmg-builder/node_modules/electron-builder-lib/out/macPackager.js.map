{"version":3,"file":"macPackager.js","sourceRoot":"","sources":["../src/macPackager.ts"],"names":[],"mappings":"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","sourcesContent":["import BluebirdPromise from \"bluebird-lst\"\nimport { deepAssign, Arch, AsyncTaskManager, exec, InvalidConfigurationError, log } from \"builder-util\"\nimport { signAsync, SignOptions } from \"electron-osx-sign\"\nimport { ensureDir, readdir, remove } from \"fs-extra-p\"\nimport { Lazy } from \"lazy-val\"\nimport * as path from \"path\"\nimport * as semver from \"semver\"\nimport { asArray } from \"builder-util-runtime/out\"\nimport { AppInfo } from \"./appInfo\"\nimport { AsarIntegrity } from \"./asar/integrity\"\nimport { appleCertificatePrefixes, CertType, CodeSigningInfo, createKeychain, findIdentity, Identity, isSignAllowed, reportError } from \"./codeSign\"\nimport { DIR_TARGET, Platform, Target } from \"./core\"\nimport { MacConfiguration, MasConfiguration } from \"./options/macOptions\"\nimport { Packager } from \"./packager\"\nimport { createMacApp } from \"./packager/mac\"\nimport { chooseNotNull, PlatformPackager } from \"./platformPackager\"\nimport { ArchiveTarget } from \"./targets/ArchiveTarget\"\nimport { PkgTarget, prepareProductBuildArgs } from \"./targets/pkg\"\nimport { createCommonTarget, NoOpTarget } from \"./targets/targetFactory\"\nimport { CONCURRENCY } from \"builder-util/out/fs\"\n\nexport default class MacPackager extends PlatformPackager<MacConfiguration> {\n  readonly codeSigningInfo = new Lazy<CodeSigningInfo>(() => {\n    const cscLink = this.getCscLink()\n    if (cscLink == null || process.platform !== \"darwin\") {\n      return Promise.resolve({keychainName: process.env.CSC_KEYCHAIN || null})\n    }\n\n    return createKeychain({\n      tmpDir: this.info.tempDirManager,\n      cscLink,\n      cscKeyPassword: this.getCscPassword(),\n      cscILink: chooseNotNull(this.platformSpecificBuildOptions.cscInstallerLink, process.env.CSC_INSTALLER_LINK),\n      cscIKeyPassword: chooseNotNull(this.platformSpecificBuildOptions.cscInstallerKeyPassword, process.env.CSC_INSTALLER_KEY_PASSWORD),\n      currentDir: this.projectDir\n    })\n  })\n\n  private _iconPath = new Lazy(() => this.getOrConvertIcon(\"icns\"))\n\n  constructor(info: Packager) {\n    super(info, Platform.MAC)\n  }\n\n  get defaultTarget(): Array<string> {\n    const electronUpdaterCompatibility = this.platformSpecificBuildOptions.electronUpdaterCompatibility\n    return (electronUpdaterCompatibility == null || semver.satisfies(\"2.16.0\", electronUpdaterCompatibility)) ? [\"zip\", \"dmg\"] : [\"dmg\"]\n  }\n\n  protected prepareAppInfo(appInfo: AppInfo): AppInfo {\n    return new AppInfo(this.info, this.platformSpecificBuildOptions.bundleVersion)\n  }\n\n  async getIconPath(): Promise<string | null> {\n    return this._iconPath.value\n  }\n\n  createTargets(targets: Array<string>, mapper: (name: string, factory: (outDir: string) => Target) => void): void {\n    for (const name of targets) {\n      switch (name) {\n        case DIR_TARGET:\n          break\n\n        case \"dmg\":\n          const { DmgTarget } = require(\"dmg-builder\")\n          mapper(name, outDir => new DmgTarget(this, outDir))\n          break\n\n        case \"zip\":\n          // https://github.com/electron-userland/electron-builder/issues/2313\n          mapper(name, outDir => new ArchiveTarget(name, outDir, this, true))\n          break\n\n        case \"pkg\":\n          mapper(name, outDir => new PkgTarget(this, outDir))\n          break\n\n        default:\n          mapper(name, outDir => name === \"mas\" || name === \"mas-dev\" ? new NoOpTarget(name) : createCommonTarget(name, outDir, this))\n          break\n      }\n    }\n  }\n\n  async pack(outDir: string, arch: Arch, targets: Array<Target>, taskManager: AsyncTaskManager): Promise<any> {\n    let nonMasPromise: Promise<any> | null = null\n\n    const hasMas = targets.length !== 0 && targets.some(it => it.name === \"mas\" || it.name === \"mas-dev\")\n    const prepackaged = this.packagerOptions.prepackaged\n\n    if (!hasMas || targets.length > 1) {\n      const appPath = prepackaged == null ? path.join(this.computeAppOutDir(outDir, arch), `${this.appInfo.productFilename}.app`) : prepackaged\n      nonMasPromise = (prepackaged ? Promise.resolve() : this.doPack(outDir, path.dirname(appPath), this.platform.nodeName, arch, this.platformSpecificBuildOptions, targets))\n        .then(() => this.sign(appPath, null, null))\n        .then(() => this.packageInDistributableFormat(appPath, Arch.x64, targets, taskManager))\n    }\n\n    for (const target of targets) {\n      const targetName = target.name\n      if (!(targetName === \"mas\" || targetName === \"mas-dev\")) {\n        continue\n      }\n\n      const masBuildOptions = deepAssign({}, this.platformSpecificBuildOptions, (this.config as any).mas)\n      if (targetName === \"mas-dev\") {\n        deepAssign(masBuildOptions, (this.config as any)[targetName], {\n          type: \"development\",\n        })\n      }\n\n      const targetOutDir = path.join(outDir, targetName)\n      if (prepackaged == null) {\n        await this.doPack(outDir, targetOutDir, \"mas\", arch, masBuildOptions, [target])\n        await this.sign(path.join(targetOutDir, `${this.appInfo.productFilename}.app`), targetOutDir, masBuildOptions)\n      }\n      else {\n        await this.sign(prepackaged, targetOutDir, masBuildOptions)\n      }\n    }\n\n    if (nonMasPromise != null) {\n      await nonMasPromise\n    }\n  }\n\n  private async sign(appPath: string, outDir: string | null, masOptions: MasConfiguration | null): Promise<void> {\n    if (!isSignAllowed()) {\n      return\n    }\n\n    const isMas = masOptions != null\n    const macOptions = this.platformSpecificBuildOptions\n    const qualifier = (isMas ? masOptions!.identity : null) || macOptions.identity\n\n    if (!isMas && qualifier === null) {\n      if (this.forceCodeSigning) {\n        throw new InvalidConfigurationError(\"identity explicitly is set to null, but forceCodeSigning is set to true\")\n      }\n      log.info({reason: \"identity explicitly is set to null\"}, \"skipped macOS code signing\")\n      return\n    }\n\n    const keychainName = (await this.codeSigningInfo.value).keychainName\n    const explicitType = isMas ? masOptions!.type : macOptions.type\n    const type = explicitType || \"distribution\"\n    const isDevelopment = type === \"development\"\n    const certificateType = getCertificateType(isMas, isDevelopment)\n    let identity = await findIdentity(certificateType, qualifier, keychainName)\n    if (identity == null) {\n      if (!isMas && !isDevelopment && explicitType !== \"distribution\") {\n        identity = await findIdentity(\"Mac Developer\", qualifier, keychainName)\n        if (identity != null) {\n          log.warn(\"Mac Developer is used to sign app — it is only for development and testing, not for production\")\n        }\n      }\n\n      if (identity == null) {\n        await reportError(isMas, certificateType, qualifier, keychainName, this.forceCodeSigning)\n        return\n      }\n    }\n\n    const signOptions: any = {\n      \"identity-validation\": false,\n      // https://github.com/electron-userland/electron-builder/issues/1699\n      // kext are signed by the chipset manufacturers. You need a special certificate (only available on request) from Apple to be able to sign kext.\n      ignore: (file: string) => {\n        return file.endsWith(\".kext\") || file.startsWith(\"/Contents/PlugIns\", appPath.length) ||\n          // https://github.com/electron-userland/electron-builder/issues/2010\n          file.includes(\"/node_modules/puppeteer/.local-chromium\")\n      },\n      identity: identity!,\n      type,\n      platform: isMas ? \"mas\" : \"darwin\",\n      version: this.config.electronVersion,\n      app: appPath,\n      keychain: keychainName || undefined,\n      binaries: (isMas && masOptions != null ? masOptions.binaries : macOptions.binaries) || undefined,\n      requirements: isMas || macOptions.requirements == null ? undefined : await this.getResource(macOptions.requirements),\n      \"gatekeeper-assess\": appleCertificatePrefixes.find(it => identity!.name.startsWith(it)) != null\n    }\n\n    await this.adjustSignOptions(signOptions, masOptions)\n    log.info({\n      file: log.filePath(appPath),\n      identityName: identity.name,\n      identityHash: identity.hash,\n    }, \"signing\")\n    await this.doSign(signOptions)\n\n    // https://github.com/electron-userland/electron-builder/issues/1196#issuecomment-312310209\n    if (masOptions != null && !isDevelopment) {\n      const certType = isDevelopment ? \"Mac Developer\" : \"3rd Party Mac Developer Installer\"\n      const masInstallerIdentity = await findIdentity(certType, masOptions.identity, keychainName)\n      if (masInstallerIdentity == null) {\n        throw new InvalidConfigurationError(`Cannot find valid \"${certType}\" identity to sign MAS installer, please see https://electron.build/code-signing`)\n      }\n\n      const artifactName = this.expandArtifactNamePattern(masOptions, \"pkg\")\n      const artifactPath = path.join(outDir!, artifactName)\n      await this.doFlat(appPath, artifactPath, masInstallerIdentity, keychainName)\n      this.dispatchArtifactCreated(artifactPath, null, Arch.x64, this.computeSafeArtifactName(artifactName, \"pkg\"))\n    }\n  }\n\n  private async adjustSignOptions(signOptions: any, masOptions: MasConfiguration | null) {\n    const resourceList = await this.resourceList\n    if (resourceList.includes(`entitlements.osx.plist`)) {\n      throw new InvalidConfigurationError(\"entitlements.osx.plist is deprecated name, please use entitlements.mac.plist\")\n    }\n    if (resourceList.includes(`entitlements.osx.inherit.plist`)) {\n      throw new InvalidConfigurationError(\"entitlements.osx.inherit.plist is deprecated name, please use entitlements.mac.inherit.plist\")\n    }\n\n    const customSignOptions = masOptions || this.platformSpecificBuildOptions\n    const entitlementsSuffix = masOptions == null ? \"mac\" : \"mas\"\n    if (customSignOptions.entitlements == null) {\n      const p = `entitlements.${entitlementsSuffix}.plist`\n      if (resourceList.includes(p)) {\n        signOptions.entitlements = path.join(this.info.buildResourcesDir, p)\n      }\n    }\n    else {\n      signOptions.entitlements = customSignOptions.entitlements\n    }\n\n    if (customSignOptions.entitlementsInherit == null) {\n      const p = `entitlements.${entitlementsSuffix}.inherit.plist`\n      if (resourceList.includes(p)) {\n        signOptions[\"entitlements-inherit\"] = path.join(this.info.buildResourcesDir, p)\n      }\n    }\n    else {\n      signOptions[\"entitlements-inherit\"] = customSignOptions.entitlementsInherit\n    }\n  }\n\n  //noinspection JSMethodCanBeStatic\n  protected async doSign(opts: SignOptions): Promise<any> {\n    return signAsync(opts)\n  }\n\n  //noinspection JSMethodCanBeStatic\n  protected async doFlat(appPath: string, outFile: string, identity: Identity, keychain: string | null | undefined): Promise<any> {\n    // productbuild doesn't created directory for out file\n    await ensureDir(path.dirname(outFile))\n\n    const args = prepareProductBuildArgs(identity, keychain)\n    args.push(\"--component\", appPath, \"/Applications\")\n    args.push(outFile)\n    return await exec(\"productbuild\", args)\n  }\n\n  public getElectronSrcDir(dist: string) {\n    return path.resolve(this.projectDir, dist, this.electronDistMacOsAppName)\n  }\n\n  public getElectronDestinationDir(appOutDir: string) {\n    return path.join(appOutDir, this.electronDistMacOsAppName)\n  }\n\n  protected async beforeCopyExtraFiles(appOutDir: string, asarIntegrity: AsarIntegrity | null): Promise<any> {\n    await createMacApp(this, appOutDir, asarIntegrity)\n\n    const wantedLanguages = asArray(this.platformSpecificBuildOptions.electronLanguages)\n    if (wantedLanguages.length === 0) {\n      return\n    }\n\n    // noinspection SpellCheckingInspection\n    const langFileExt = \".lproj\"\n    const resourcesDir = this.getResourcesDir(appOutDir)\n    await BluebirdPromise.map(readdir(resourcesDir), file => {\n      if (!file.endsWith(langFileExt)) {\n        return\n      }\n\n      const language = file.substring(0, file.length - langFileExt.length)\n      if (!wantedLanguages.includes(language)) {\n        return remove(path.join(resourcesDir, file))\n      }\n      return\n    }, CONCURRENCY)\n  }\n}\n\nfunction getCertificateType(isMas: boolean, isDevelopment: boolean): CertType {\n  if (isDevelopment) {\n    return \"Mac Developer\"\n  }\n  return isMas ? \"3rd Party Mac Developer Application\" : \"Developer ID Application\"\n}"]}
