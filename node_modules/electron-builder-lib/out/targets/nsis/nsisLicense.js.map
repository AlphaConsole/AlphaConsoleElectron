{"version":3,"file":"nsisLicense.js","sourceRoot":"","sources":["../../../src/targets/nsis/nsisLicense.ts"],"names":[],"mappings":";;;;;;;;;;;;;;oEAQO,AAAK,WAA6B,AAAqB,UAAE,AAAoB,SAAE,AAAoC,iBAAE,AAAwB;AAClJ,cAAM,AAAO,UAAG,MAAM,AAA2B,+DAAC,AAAO,QAAC,AAAO,SAAE,AAAQ,AAAC;AAC5E,AAAE,AAAC,YAAC,AAAO,WAAI,AAAI,AAAC,MAAC,AAAC;AACpB,gBAAI,AAA0B;AAC9B,AAAE,AAAC,gBAAC,AAAO,QAAC,AAAQ,SAAC,AAAO,AAAC,AAAC,UAAC,AAAC;AAC9B,AAAW,8BAAG,CACZ,AAAkD,oDAClD,AAAsB,wBACtB,AAA0C,4CAC1C,AAA2B,6BAC3B,AAA+D,iEAC/D,AAAa,AAEb,iDAAkC,AAAI,MAAC,AAAI,AAAC,AAAgB,uDAAE,AAAmB,AAAC,oBAAG,AACtF,AACH;AAAC,AACD,AAAI,mBAAC,AAAC;AACJ,AAAW,8BAAG,AAAC,mCAAkC,AAAO,OAAG,AAAC,AAC9D;AAAC;AAED,AAAe,4BAAC,AAAK,MAAC,AAAa,eAAE,AAAW,AAAC;AACjD,AAAE,AAAC,gBAAC,AAAO,QAAC,AAAQ,SAAC,AAAO,AAAC,AAAC,UAAC,AAAC;AAC9B,AAAe,gCAAC,AAAK,MAAC,AAAiB,mBAAE,AAAC,2CAA0C,AAAO,OAAG,AAAC,AAAC,AAClG;AAAC;AACD,AAAM,AACR;AAAC;AAED,cAAM,AAAY,eAAG,MAAM,AAAe,mDAAC,AAAQ,AAAC;AACpD,AAAE,AAAC,YAAC,AAAY,aAAC,AAAM,WAAK,AAAC,AAAC,GAAC,AAAC;AAC9B,AAAM,AACR;AAAC;AAED,cAAM,AAAW,cAAkB,AAAE;AACrC,cAAM,AAAgB,mBAAG,IAAI,AAAG,IAAC,AAAS,AAAC;AAE3C,YAAI,AAAW,cAAkB,AAAI;AACrC,AAAG,AAAC,aAAC,MAAM,AAAI,QAAI,AAAY,AAAC,cAAC,AAAC;AAChC,AAAgB,6BAAC,AAAM,OAAC,AAAI,KAAC,AAAc,AAAC;AAC5C,AAAE,AAAC,gBAAC,AAAW,eAAI,AAAI,AAAC,MAAC,AAAC;AACxB,AAAW,8BAAG,AAAI,KAAC,AAAI,AACzB;AAAC;AACD,AAAW,wBAAC,AAAI,AAAC,qCAAgC,AAAI,+BAAC,AAAI,KAAC,AAAc,AAAC,mBAAI,AAAI,KAAC,AAAI,SAAK,AAAI,KAAC,AAAI,IAAG,AAAC,AAC3G;AAAC;AAED,AAAG,AAAC,aAAC,MAAM,AAAC,KAAI,AAAgB,AAAC,kBAAC,AAAC;AACjC,AAAW,wBAAC,AAAI,AAAC,qCAAgC,AAAI,+BAAC,AAAC,AAAC,OAAK,AAAW,WAAG,AAAC,AAC9E;AAAC;AAED,AAAW,oBAAC,AAAI,KAAC,AAA+C,AAAC;AACjE,AAAe,wBAAC,AAAK,MAAC,AAAa,eAAE,AAAW,AAAC,AACnD;AAAC;;;;;;;;;;;AA1DD,AAAO,AAAE,AAAI,AAAE,AAAM,AAAwB;;;;;;AAC7C,AAAO,AAAE,AAAe,AAAE,AAA2B,AAAE,AAAM,AAA0B;;;;AACvF,AAAO,AAAK,AAAI,AAAM,AAAM;;;;AAI5B,AAAO,AAAE,AAAgB,AAAE,AAAM,AAAY,AAE7C,AAAM","sourcesContent":["import { lcid } from \"builder-util/out/langs\"\nimport { getLicenseFiles, getNotLocalizedLicenseFiles } from \"builder-util/out/license\"\nimport * as path from \"path\"\nimport { WinPackager } from \"../../winPackager\"\nimport { NsisOptions } from \"./nsisOptions\"\nimport { NsisScriptGenerator } from \"./nsisScriptGenerator\"\nimport { nsisTemplatesDir } from \"./nsisUtil\"\n\nexport async function computeLicensePage(packager: WinPackager, options: NsisOptions, scriptGenerator: NsisScriptGenerator, languages: Array<string>): Promise<void> {\n  const license = await getNotLocalizedLicenseFiles(options.license, packager)\n  if (license != null) {\n    let licensePage: Array<string>\n    if (license.endsWith(\".html\")) {\n      licensePage = [\n        \"!define MUI_PAGE_CUSTOMFUNCTION_SHOW LicenseShow\",\n        \"Function LicenseShow\",\n        \"  FindWindow $R0 `#32770` `` $HWNDPARENT\",\n        \"  GetDlgItem $R0 $R0 1000\",\n        \"EmbedHTML::Load /replace $R0 file://$PLUGINSDIR\\\\license.html\",\n        \"FunctionEnd\",\n\n        `!insertmacro MUI_PAGE_LICENSE \"${path.join(nsisTemplatesDir, \"empty-license.txt\")}\"`,\n      ]\n    }\n    else {\n      licensePage = [`!insertmacro MUI_PAGE_LICENSE \"${license}\"`]\n    }\n\n    scriptGenerator.macro(\"licensePage\", licensePage)\n    if (license.endsWith(\".html\")) {\n      scriptGenerator.macro(\"addLicenseFiles\", [`File /oname=$PLUGINSDIR\\\\license.html \"${license}\"`])\n    }\n    return\n  }\n\n  const licenseFiles = await getLicenseFiles(packager)\n  if (licenseFiles.length === 0) {\n    return\n  }\n\n  const licensePage: Array<string> = []\n  const unspecifiedLangs = new Set(languages)\n\n  let defaultFile: string | null = null\n  for (const item of licenseFiles) {\n    unspecifiedLangs.delete(item.langWithRegion)\n    if (defaultFile == null) {\n      defaultFile = item.file\n    }\n    licensePage.push(`LicenseLangString MUILicense ${lcid[item.langWithRegion] || item.lang} \"${item.file}\"`)\n  }\n\n  for (const l of unspecifiedLangs) {\n    licensePage.push(`LicenseLangString MUILicense ${lcid[l]} \"${defaultFile}\"`)\n  }\n\n  licensePage.push('!insertmacro MUI_PAGE_LICENSE \"$(MUILicense)\"')\n  scriptGenerator.macro(\"licensePage\", licensePage)\n}\n"]}
